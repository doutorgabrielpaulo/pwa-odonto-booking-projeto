{% extends "layout.html" %}
{% block content %}
<div class="p-4 md:p-8">
    <div class="w-full max-w-2xl mx-auto space-y-4">
        <div class="text-center">
            <h2 class="text-2xl font-bold text-gray-800">Termos de Uso e Contrato</h2>
            <p class="text-sm text-gray-500">Por favor, leia, envie os documentos e assine para continuar.</p>
        </div>
        
        <!-- Caixa de Contrato -->
        <div class="border rounded-lg p-4 h-64 overflow-y-auto bg-gray-50 text-sm">
            {{ contract_text | safe }}
        </div>

        <!-- Formulário de Aceite -->
        <form id="contract-form" method="POST" action="{{ url_for('main.accept_contract') }}" enctype="multipart/form-data">
            
            <!-- Upload de Arquivos -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-4">
                <div>
                    <label class="text-xs font-semibold text-gray-500">SELFIE (SEGURANDO O DOCUMENTO)</label>
                    <input type="file" name="selfie" required class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
                <div>
                    <label class="text-xs font-semibold text-gray-500">FOTO DO DOCUMENTO (FRENTE E VERSO)</label>
                    <input type="file" name="document" required class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                </div>
            </div>

            <!-- Campo de Assinatura -->
            <div>
                <label class="text-xs font-semibold text-gray-500">ASSINATURA DIGITAL (desenhe no quadro abaixo)</label>
                <div class="border-2 border-dashed rounded-lg mt-1 bg-white">
                    <canvas id="signature-pad" class="w-full h-40"></canvas>
                </div>
                <button type="button" id="clear-signature" class="text-xs text-blue-600 hover:underline mt-1">Limpar Assinatura</button>
                <input type="hidden" name="signature" id="signature-data">
            </div>

            <button type="submit" class="w-full p-3 mt-4 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700">Li e Aceito os Termos</button>
        </form>
    </div>
</div>
<!-- Script para a assinatura digital -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const canvas = document.getElementById('signature-pad');
        const signaturePad = new SignaturePad(canvas, {
            backgroundColor: 'rgb(255, 255, 255)'
        });

        const clearButton = document.getElementById('clear-signature');
        clearButton.addEventListener('click', function () {
            signaturePad.clear();
        });

        const form = document.getElementById('contract-form');
        const signatureInput = document.getElementById('signature-data');
        form.addEventListener('submit', function (event) {
            if (signaturePad.isEmpty()) {
                alert("Por favor, forneça sua assinatura.");
                event.preventDefault();
            } else {
                signatureInput.value = signaturePad.toDataURL();
            }
        });
    });
</script>
{% endblock %}
